-- âœ… Setup globals
getgenv().ChamsEnabled = false
getgenv().Rainbow = false

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local rainbowChams = {}

-- Rainbow color over time
local function getRainbowColor(t)
	return Color3.new(
		math.sin(t) * 0.5 + 0.5,
		math.sin(t + 2) * 0.5 + 0.5,
		math.sin(t + 4) * 0.5 + 0.5
	)
end

-- Static color fallback (purple)
local staticColor = Color3.fromRGB(170, 0, 255)

-- Create or reuse highlight
local function addChamToCharacter(char)
	if char:FindFirstChild("RainbowCham") then return end
	if not getgenv().ChamsEnabled then return end

	local highlight = Instance.new("Highlight")
	highlight.Name = "RainbowCham"
	highlight.Adornee = char
	highlight.FillTransparency = 0.25
	highlight.OutlineTransparency = 0
	highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	highlight.OutlineColor = Color3.new(1, 1, 1)
	highlight.FillColor = staticColor
	highlight.Parent = char

	table.insert(rainbowChams, highlight)
end

-- Track characters
local function setupPlayer(player)
	if player == LocalPlayer then return end

	player.CharacterAdded:Connect(addChamToCharacter)
	if player.Character then
		addChamToCharacter(player.Character)
	end
end

-- Loop through all players
for _, player in ipairs(Players:GetPlayers()) do
	setupPlayer(player)
end
Players.PlayerAdded:Connect(setupPlayer)

-- Update loop
RunService.Heartbeat:Connect(function()
	for i = #rainbowChams, 1, -1 do
		local cham = rainbowChams[i]

		if not getgenv().ChamsEnabled then
			if cham and cham.Parent then
				cham:Destroy()
			end
			table.remove(rainbowChams, i)
		elseif cham and cham.Parent then
			if getgenv().Rainbow then
				cham.FillColor = getRainbowColor(tick() * 2.5)
			else
				cham.FillColor = staticColor
			end
		else
			table.remove(rainbowChams, i)
		end
	end
end)
